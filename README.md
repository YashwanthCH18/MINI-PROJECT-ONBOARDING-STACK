# Onboarding Profile Stack

FastAPI microservice for managing user onboarding profiles.

## Documentation
**[INTEGRATION_GUIDE.md](INTEGRATION_GUIDE.md)** contains detailed API usage instructions. (Note: This file is ignored from git for security; refer to your local copy).

## Purpose
The **Onboarding Microservice** is a dedicated backend service responsible for managing user profiles after they have authenticated via Supabase. It serves as the central API for storing and retrieving user details, skills, education, and career preferences.

## Usage
This stack is intended to be consumed by the frontend application (React/Next.js). It accepts JSON web tokens (JWTs) generated by Supabase Auth to identify users and securely manage their data in the database.

## Features
- **Profile Management**: CRUD operations for user profiles.
- **Secure Integration**: Uses Supabase Service Role for backend operations but requires valid User JWTs for all API access.
- **Serverless**: Deployed on AWS Lambda for scalability.

## Setup & Development

### 1. Install Dependencies
```bash
pip install -r requirements.txt
```

### 2. Local Development
To run locally, you must have a valid Supabase `.env` file.
```bash
uvicorn app.main:app --reload --port 8001
```

### 3. Deployment
Deployed via AWS SAM (Serverless Application Model).

```bash
# Build
sam build

# Deploy (Interactive)
sam deploy --guided
```
**Required Secrets during deployment:** `SupabaseUrl`, `SupabaseKey`, `SecretKey`.

## Database Tables

### `profiles`
- `id` (uuid, primary key) - Matches Supabase Auth User ID
- `full_name`, `date_of_birth`, `address`...
- `skills` (text[])
- `career_preferences` (jsonb)
- `education` (jsonb)
- `onboarding_completed` (boolean)

## Troubleshooting
- **401 Unauthorized**: Ensure your token is fresh and from Supabase (not a custom signed token).
- **Invalid Audience**: Ensure the token has `"aud": "authenticated"`.
- **500 Internal Server Error**: Check Lambda environment variables in AWS Console.
